#!/bin/bash


# Generate passwd file based on current uid
function generate_passwd_file() {
  USER_ID=$(id -u)
  GROUP_ID=$(id -g)

  if [ x"$USER_ID" != x"0" ]; then

    echo "default:x:${USER_ID}:${GROUP_ID}:Default Application User:${HOME}:/sbin/nologin" >> /etc/passwd

  fi
}

generate_passwd_file

if [ $INIT_DATASOURCE ]; then
    curl -X POST -d @/usr/share/grafana/ --header "Content-Type: application/json" \
        http://${GF_SECURITY_ADMIN_USER}:${GF_SECURITY_ADMIN_PASSWORD}@localhost:3000/api/datasources
fi

exec /usr/sbin/grafana-server                   \
  --homepath=/usr/share/grafana                 \
  --config=/etc/grafana/grafana.ini             \
  "$@"
